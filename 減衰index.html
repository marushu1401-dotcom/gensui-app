<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>減衰計算表</title>
    
    <!-- Tailwind CSS (デザイン用) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM (プログラムの土台) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel (コード変換用) -->
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    <style>
        body { font-family: sans-serif; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo } = React;

        // --- アイコンコンポーネント (Lucide互換の簡易SVG) ---
        const Icon = ({ children, className, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>
        );

        const Activity = (props) => <Icon {...props}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></Icon>;
        const Calculator = (props) => <Icon {...props}><rect x="4" y="2" width="16" height="20" rx="2"></rect><line x1="8" y1="6" x2="16" y2="6"></line><line x1="16" y1="14" x2="16" y2="18"></line><path d="M16 10h.01"></path><path d="M12 10h.01"></path><path d="M8 10h.01"></path><path d="M12 14h.01"></path><path d="M8 14h.01"></path><path d="M12 18h.01"></path><path d="M8 18h.01"></path></Icon>;
        const Info = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></Icon>;
        const RefreshCw = (props) => <Icon {...props}><path d="M21 2v6h-6"></path><path d="M3 12a9 9 0 0 1 15-6.7L21 8"></path><path d="M3 22v-6h6"></path><path d="M21 12a9 9 0 0 1-15 6.7L3 16"></path></Icon>;
        const CalendarIcon = (props) => <Icon {...props}><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></Icon>;
        const Hourglass = (props) => <Icon {...props}><path d="M5 22h14"></path><path d="M5 2h14"></path><path d="M17 22v-4.172a2 2 0 0 0-.586-1.414L12 12l-4.414 4.414A2 2 0 0 0 7 17.828V22"></path><path d="M7 2v4.172a2 2 0 0 0 .586 1.414L12 12l4.414-4.414A2 2 0 0 0 17 6.172V2"></path></Icon>;
        const Settings = (props) => <Icon {...props}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></Icon>;
        const Plus = (props) => <Icon {...props}><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></Icon>;
        const Trash2 = (props) => <Icon {...props}><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></Icon>;
        const XIcon = (props) => <Icon {...props}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></Icon>;
        const Save = (props) => <Icon {...props}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></Icon>;
        const CheckSquare = (props) => <Icon {...props}><polyline points="9 11 12 14 22 4"></polyline><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></Icon>;

        // --- 以下、アプリのロジック ---

        const TIME_UNITS = {
            days: { label: '日', toSeconds: 86400 },
            minutes: { label: '分', toSeconds: 60 },
            seconds: { label: '秒', toSeconds: 1 },
        };

        const formatNumber = (num) => {
            if (num === 0) return '0';
            if (Math.abs(num) < 0.0001 || Math.abs(num) > 1000000) {
                return num.toExponential(4);
            }
            return num.toLocaleString(undefined, { maximumFractionDigits: 4 });
        };

        const formatDate = (date) => {
            if (!date || isNaN(date.getTime())) return '-';
            const pad = (n) => n.toString().padStart(2, '0');
            return `${date.getFullYear()}-${pad(date.getMonth() + 1)}-${pad(date.getDate())} ${pad(date.getHours())}:${pad(date.getMinutes())}:${pad(date.getSeconds())}`;
        };

        const formatDurationSimple = (seconds) => {
            const absSeconds = Math.abs(seconds);
            const units = [
                { label: '日', val: 86400 },
                { label: '分', val: 60 },
                { label: '秒', val: 1 },
            ];
            
            for (const u of units) {
                if (absSeconds >= u.val) {
                return `${(seconds / u.val).toFixed(2)} ${u.label}`;
                }
            }
            return `${seconds.toFixed(2)} 秒`;
        };

        const formatDurationDetailed = (seconds) => {
            const absSeconds = Math.abs(seconds);
            
            const days = Math.floor(absSeconds / 86400);
            const remainderAfterDays = absSeconds % 86400;
            
            const hours = Math.floor(remainderAfterDays / 3600);
            const remainderAfterHours = remainderAfterDays % 3600;
            
            const minutes = Math.floor(remainderAfterHours / 60);
            const secs = remainderAfterHours % 60;

            const parts = [];
            
            if (days > 0) parts.push(`${days}日`);
            if (hours > 0) parts.push(`${hours}時間`);
            if (minutes > 0) parts.push(`${minutes}分`);
            
            const formattedSecs = parseFloat(secs.toFixed(2));
            
            if (formattedSecs > 0 || parts.length === 0) {
                parts.push(`${formattedSecs}秒`);
            }

            return parts.join(' ');
        };

        function App() {
            const [initialAmount, setInitialAmount] = useState(1000);
            const [halfLife, setHalfLife] = useState(10986.5);
            const [halfLifeUnit, setHalfLifeUnit] = useState('days');
            const [isDetailedTime, setIsDetailedTime] = useState(false);
            
            const [baseDate, setBaseDate] = useState(() => {
                const now = new Date();
                now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
                return now.toISOString().slice(0, 19);
            });

            const [presets, setPresets] = useState([
                { id: '1', label: 'カリウム40', value: 455520000000, unit: 'days' },
                { id: '2', label: 'セシウム137', value: 10986.5, unit: 'days' },
                { id: '3', label: 'ヨウ素131', value: 8.02, unit: 'days' },
                { id: '4', label: 'トリチウム', value: 4496.8, unit: 'days' },
                { id: '5', label: 'ラジウム226', value: 584000, unit: 'days' },
            ]);
            const [isPresetModalOpen, setIsPresetModalOpen] = useState(false);
            const [newPreset, setNewPreset] = useState({ label: '', value: '', unit: 'days' });

            const handleAddPreset = () => {
                if (!newPreset.label || !newPreset.value) return;
                if (presets.length >= 10) return;
                
                setPresets([
                    ...presets, 
                    { 
                        id: Date.now().toString(), 
                        label: newPreset.label, 
                        value: Number(newPreset.value), 
                        unit: newPreset.unit 
                    }
                ]);
                setNewPreset({ label: '', value: '', unit: 'days' });
            };

            const handleDeletePreset = (id) => {
                setPresets(presets.filter(p => p.id !== id));
            };

            const [mainMode, setMainMode] = useState('amount');
            const [calcMode, setCalcMode] = useState('relative');
            const [elapsedTime, setElapsedTime] = useState(30);
            const [elapsedTimeUnit, setElapsedTimeUnit] = useState('days');
            const [targetDateInput, setTargetDateInput] = useState(() => {
                const now = new Date();
                now.setDate(now.getDate() + 30);
                now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
                return now.toISOString().slice(0, 19);
            });

            const [targetAmount, setTargetAmount] = useState(500);

            const results = useMemo(() => {
                const halfLifeInSeconds = halfLife * TIME_UNITS[halfLifeUnit].toSeconds;
                if (halfLifeInSeconds <= 0) return null;

                let elapsedInSeconds = 0;
                let currentRemaining = 0;
                let baseDateObj = new Date(baseDate);
                let targetDateObj = new Date();

                if (mainMode === 'amount') {
                    if (calcMode === 'relative') {
                        elapsedInSeconds = elapsedTime * TIME_UNITS[elapsedTimeUnit].toSeconds;
                        targetDateObj = new Date(baseDateObj.getTime() + elapsedInSeconds * 1000);
                    } else {
                        targetDateObj = new Date(targetDateInput);
                        elapsedInSeconds = (targetDateObj.getTime() - baseDateObj.getTime()) / 1000;
                    }
                    currentRemaining = initialAmount * Math.pow(0.5, elapsedInSeconds / halfLifeInSeconds);
                } else {
                    if (initialAmount <= 0 || targetAmount <= 0) {
                        elapsedInSeconds = 0;
                        currentRemaining = initialAmount;
                    } else {
                        const ratio = targetAmount / initialAmount;
                        elapsedInSeconds = -halfLifeInSeconds * Math.log2(ratio);
                    }
                    targetDateObj = new Date(baseDateObj.getTime() + elapsedInSeconds * 1000);
                    currentRemaining = targetAmount;
                }

                const decayed = initialAmount - currentRemaining;
                const percentage = initialAmount !== 0 ? (currentRemaining / initialAmount) * 100 : 0;

                return {
                    remaining: currentRemaining,
                    decayed,
                    percentage,
                    halfLifeInSeconds,
                    elapsedInSeconds,
                    baseDateObj,
                    targetDateObj
                };
            }, [initialAmount, halfLife, halfLifeUnit, mainMode, calcMode, elapsedTime, elapsedTimeUnit, baseDate, targetDateInput, targetAmount]);

            const chartData = useMemo(() => {
                if (!results) return [];
                
                const t = results.elapsedInSeconds;
                const hl = results.halfLifeInSeconds;
                
                let minTime = 0;
                let maxTime = hl * 5;

                if (t >= 0) {
                    minTime = - Math.max(t * 0.1, hl);
                    maxTime = Math.max(t * 1.2, hl * 5);
                } else {
                    minTime = Math.min(t * 1.2, -hl);
                    maxTime = Math.max(Math.abs(t) * 0.1, hl * 5);
                }

                const points = [];
                const steps = 100;
                const totalRange = maxTime - minTime;
                
                for (let i = 0; i <= steps; i++) {
                    const time = minTime + (totalRange / steps) * i;
                    const amount = initialAmount * Math.pow(0.5, time / hl);
                    points.push({ t: time, amount });
                }
                
                return { points, minTime, maxTime, totalRange };
            }, [results, initialAmount]);

            const formatTimeForAxis = (seconds) => {
                const abs = Math.abs(seconds);
                if (abs >= 86400) return `${(seconds/86400).toFixed(1)}日`;
                if (abs >= 60) return `${(seconds/60).toFixed(1)}分`;
                return `${seconds.toFixed(0)}秒`;
            };

            const formatResultTime = (seconds) => {
                return isDetailedTime ? formatDurationDetailed(seconds) : formatDurationSimple(seconds);
            };

            const Graph = () => {
                if (!results || chartData.points.length === 0) return null;

                const width = 600;
                const height = 300;
                const padding = 40;
                
                const maxYData = Math.max(initialAmount, ...chartData.points.map(p => p.amount));
                const yAxisMax = maxYData * 1.1;

                const getX = (t) => padding + ((t - chartData.minTime) / chartData.totalRange) * (width - padding * 2);
                const getY = (amt) => height - padding - (amt / yAxisMax) * (height - padding * 2);

                const pathD = `M ${chartData.points.map(p => `${getX(p.t)},${getY(p.amount)}`).join(' L ')}`;
                const currentX = getX(results.elapsedInSeconds);
                const currentY = getY(results.remaining);
                const zeroX = getX(0);

                return (
                    <div className="w-full overflow-hidden bg-white rounded-lg shadow-inner border border-slate-200">
                        <svg viewBox={`0 0 ${width} ${height}`} className="w-full h-auto text-xs">
                            {[0, 0.25, 0.5, 0.75, 1].map(r => (
                                <line key={`h-${r}`} x1={padding} y1={getY(yAxisMax*r)} x2={width-padding} y2={getY(yAxisMax*r)} stroke="#f1f5f9" strokeWidth="1" />
                            ))}

                            <line x1={padding} y1={height-padding} x2={width-padding} y2={height-padding} stroke="#cbd5e1" strokeWidth="2" />
                            <line x1={padding} y1={padding} x2={padding} y2={height-padding} stroke="#cbd5e1" strokeWidth="2" />

                            {zeroX > padding && zeroX < width - padding && (
                                <g>
                                    <line x1={zeroX} y1={padding} x2={zeroX} y2={height-padding} stroke="#94a3b8" strokeWidth="1" strokeDasharray="4 4" />
                                    <text x={zeroX} y={height-5} textAnchor="middle" fill="#64748b" fontSize="10">基準(t=0)</text>
                                </g>
                            )}

                            <path d={pathD} fill="none" stroke="#3b82f6" strokeWidth="3" />

                            <line x1={currentX} y1={padding} x2={currentX} y2={height-padding} stroke="#ef4444" strokeWidth="1.5" strokeDasharray="2 2" />
                            <line x1={padding} y1={currentY} x2={width-padding} y2={currentY} stroke="#ef4444" strokeWidth="1.5" strokeDasharray="2 2" />
                            <circle cx={currentX} cy={currentY} r="6" fill="#ef4444" stroke="white" strokeWidth="2" />
                            
                            <text x={padding-5} y={getY(yAxisMax)} textAnchor="end" dominantBaseline="middle" fill="#64748b">{formatNumber(yAxisMax)} MBq</text>
                            <text x={padding-5} y={getY(initialAmount)} textAnchor="end" dominantBaseline="middle" fill="#3b82f6" fontWeight="bold">N₀ (MBq)</text>

                            <text x={width-padding} y={height-20} textAnchor="end" fill="#64748b">{formatTimeForAxis(chartData.maxTime)}</text>
                            <text x={padding} y={height-20} textAnchor="start" fill="#64748b">{formatTimeForAxis(chartData.minTime)}</text>

                            <text x={currentX} y={padding-10} textAnchor="middle" fill="#ef4444" fontWeight="bold">
                                {mainMode === 'amount' ? '計算結果' : '目標地点'}
                            </text>
                        </svg>
                    </div>
                );
            };

            return (
                <div className="min-h-screen bg-slate-50 p-4 md:p-8 font-sans text-slate-800">
                    <div className="max-w-5xl mx-auto">
                        
                        <header className="mb-8 flex items-center gap-3">
                            <div className="p-3 bg-blue-600 rounded-lg shadow-lg">
                                <Activity className="w-8 h-8 text-white" />
                            </div>
                            <div>
                                <h1 className="text-2xl font-bold text-slate-900">減衰計算表</h1>
                                <p className="text-slate-500 text-sm">Radioactive Decay Calculator</p>
                            </div>
                        </header>

                        <div className="flex rounded-xl bg-white shadow-sm border border-slate-200 p-1 mb-8">
                            <button
                                onClick={() => setMainMode('amount')}
                                className={`flex-1 flex items-center justify-center gap-2 py-3 rounded-lg text-sm font-bold transition-all ${
                                mainMode === 'amount'
                                    ? 'bg-blue-600 text-white shadow-md'
                                    : 'text-slate-500 hover:bg-slate-50'
                                }`}
                            >
                                <Calculator className="w-4 h-4" />
                                残存量を求める
                            </button>
                            <button
                                onClick={() => setMainMode('time')}
                                className={`flex-1 flex items-center justify-center gap-2 py-3 rounded-lg text-sm font-bold transition-all ${
                                mainMode === 'time'
                                    ? 'bg-blue-600 text-white shadow-md'
                                    : 'text-slate-500 hover:bg-slate-50'
                                }`}
                            >
                                <Hourglass className="w-4 h-4" />
                                時間を求める (逆算)
                            </button>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-12 gap-6">
                            
                            {/* --- 左カラム: 入力パラメータ --- */}
                            <div className="lg:col-span-5 space-y-6">
                                <section className="bg-white p-6 rounded-xl shadow-sm border border-slate-200 relative overflow-hidden">
                                    <div className="absolute top-0 left-0 w-1 h-full bg-blue-500"></div>
                                    <h2 className="flex items-center gap-2 font-bold text-lg mb-6 text-slate-700">
                                        <RefreshCw className="w-5 h-5 text-blue-500" />
                                        パラメータ設定
                                    </h2>

                                    <div className="space-y-6">
                                        <div className="bg-slate-50 p-3 rounded-lg border border-slate-200">
                                            <label className="block text-xs font-bold text-slate-500 mb-1 flex items-center gap-1">
                                                <CalendarIcon className="w-3 h-3" />
                                                基準日時 (スタート: t=0)
                                            </label>
                                            <input
                                                type="datetime-local"
                                                step="1"
                                                value={baseDate}
                                                onChange={(e) => setBaseDate(e.target.value)}
                                                className="w-full px-2 py-1.5 border border-slate-300 rounded focus:ring-2 focus:ring-blue-500 focus:outline-none text-sm bg-white"
                                            />
                                        </div>

                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-xs font-medium text-slate-600 mb-1">初期量 (N₀)</label>
                                                <div className="flex gap-1 items-center">
                                                    <input
                                                        type="number"
                                                        value={initialAmount}
                                                        onChange={(e) => setInitialAmount(Math.max(0, Number(e.target.value)))}
                                                        className="w-full px-3 py-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 text-sm"
                                                    />
                                                    <span className="text-xs text-slate-500 font-bold whitespace-nowrap">MBq</span>
                                                </div>
                                                <p className="text-[10px] text-slate-400 mt-1">メガベクレル</p>
                                            </div>
                                            <div>
                                                <label className="block text-xs font-medium text-slate-600 mb-1">半減期 (T₁/₂)</label>
                                                <div className="flex gap-1">
                                                    <input
                                                        type="number"
                                                        value={halfLife}
                                                        onChange={(e) => setHalfLife(Math.max(0.00001, Number(e.target.value)))}
                                                        className="w-full px-2 py-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 text-sm"
                                                    />
                                                    <select
                                                        value={halfLifeUnit}
                                                        onChange={(e) => setHalfLifeUnit(e.target.value)}
                                                        className="w-16 px-1 py-2 border border-slate-300 rounded-md bg-slate-50 text-xs"
                                                    >
                                                        {Object.entries(TIME_UNITS).map(([k, u]) => <option key={k} value={k}>{u.label}</option>)}
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="h-px bg-slate-100"></div>

                                        {mainMode === 'amount' ? (
                                            <div className="animate-in fade-in slide-in-from-left-4 duration-300">
                                                <div className="flex items-center justify-between mb-2">
                                                    <label className="text-sm font-bold text-blue-700">いつの量を求めますか？</label>
                                                    <div className="flex bg-slate-100 p-0.5 rounded text-xs">
                                                        <button onClick={() => setCalcMode('relative')} className={`px-2 py-1 rounded ${calcMode === 'relative' ? 'bg-white shadow text-blue-600' : 'text-slate-500'}`}>時間経過</button>
                                                        <button onClick={() => setCalcMode('absolute')} className={`px-2 py-1 rounded ${calcMode === 'absolute' ? 'bg-white shadow text-blue-600' : 'text-slate-500'}`}>日時指定</button>
                                                    </div>
                                                </div>

                                                {calcMode === 'relative' ? (
                                                    <div className="bg-blue-50 p-4 rounded-lg border border-blue-100">
                                                        <label className="block text-xs text-blue-800 mb-1">経過時間</label>
                                                        <div className="flex gap-2">
                                                            <input
                                                                type="number"
                                                                value={elapsedTime}
                                                                onChange={(e) => setElapsedTime(Number(e.target.value))}
                                                                className="flex-1 px-3 py-2 border border-blue-200 rounded-md focus:ring-2 focus:ring-blue-500 text-sm"
                                                            />
                                                            <select
                                                                value={elapsedTimeUnit}
                                                                onChange={(e) => setElapsedTimeUnit(e.target.value)}
                                                                className="w-24 px-2 py-2 border border-blue-200 rounded-md bg-white text-sm"
                                                            >
                                                                {Object.entries(TIME_UNITS).map(([k, u]) => <option key={k} value={k}>{u.label}</option>)}
                                                            </select>
                                                        </div>
                                                    </div>
                                                ) : (
                                                    <div className="bg-blue-50 p-4 rounded-lg border border-blue-100">
                                                        <label className="block text-xs text-blue-800 mb-1">対象日時</label>
                                                        <input
                                                            type="datetime-local"
                                                            step="1"
                                                            value={targetDateInput}
                                                            onChange={(e) => setTargetDateInput(e.target.value)}
                                                            className="w-full px-3 py-2 border border-blue-200 rounded-md focus:ring-2 focus:ring-blue-500 text-sm"
                                                        />
                                                    </div>
                                                )}
                                            </div>
                                        ) : (
                                            <div className="animate-in fade-in slide-in-from-right-4 duration-300">
                                                <label className="block text-sm font-bold text-amber-700 mb-2">目標とする残存量は？</label>
                                                <div className="bg-amber-50 p-4 rounded-lg border border-amber-100">
                                                    <label className="block text-xs text-amber-800 mb-1">目標量 (N)</label>
                                                    <div className="flex gap-2 items-center">
                                                        <input
                                                            type="number"
                                                            value={targetAmount}
                                                            onChange={(e) => setTargetAmount(Math.max(0, Number(e.target.value)))}
                                                            className="flex-1 px-3 py-2 border border-amber-200 rounded-md focus:ring-2 focus:ring-amber-500 text-sm"
                                                        />
                                                        <span className="text-xs text-amber-600 font-bold whitespace-nowrap">MBq</span>
                                                        <span className="text-xs text-amber-600 min-w-[3.5rem] text-right">
                                                            {initialAmount > 0 ? `(${(targetAmount/initialAmount*100).toFixed(1)}%)` : ''}
                                                        </span>
                                                    </div>
                                                    <p className="text-[10px] text-amber-600/70 mt-1">※ 初期量より多い値を入力すると過去の日時が計算されます</p>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </section>

                                <section className="bg-slate-50 p-4 rounded-xl border border-slate-200">
                                    <div className="flex justify-between items-center mb-2">
                                        <h3 className="text-xs font-bold text-slate-500 flex items-center gap-2">
                                            <Info className="w-3 h-3" />
                                            代表的な核種の半減期
                                        </h3>
                                        <button 
                                            onClick={() => setIsPresetModalOpen(true)}
                                            className="flex items-center gap-1 text-[10px] bg-white border border-slate-300 px-2 py-1 rounded text-slate-600 hover:bg-slate-100"
                                        >
                                            <Settings className="w-3 h-3" />
                                            編集/追加
                                        </button>
                                    </div>
                                    <div className="flex flex-wrap gap-2">
                                        {presets.map((item) => (
                                            <button
                                                key={item.id}
                                                onClick={() => { setHalfLife(item.value); setHalfLifeUnit(item.unit); }}
                                                className="px-2 py-1 bg-white hover:bg-slate-100 text-slate-600 text-[10px] rounded border border-slate-200 transition-colors"
                                            >
                                                {item.label}
                                            </button>
                                        ))}
                                    </div>
                                </section>
                            </div>

                            {/* --- 右カラム: 計算結果 --- */}
                            <div className="lg:col-span-7 space-y-6">
                                
                                {mainMode === 'amount' ? (
                                    <section className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div className="bg-white p-5 rounded-xl shadow-sm border-l-4 border-blue-500 flex flex-col justify-center">
                                            <p className="text-xs text-slate-500 mb-1">計算された残存量 (MBq)</p>
                                            <p className="text-3xl font-bold text-blue-600 tracking-tight break-all">
                                                {results ? formatNumber(results.remaining) : '-'}
                                            </p>
                                            <p className="text-xs text-slate-400 mt-1">
                                                初期量の {results ? results.percentage.toFixed(4) : '-'} %
                                            </p>
                                        </div>
                                        <div className="bg-slate-50 p-5 rounded-xl border border-slate-200 flex flex-col justify-center space-y-2">
                                            <div className="flex justify-between items-baseline">
                                                <span className="text-xs text-slate-500">対象日時</span>
                                                <span className="text-sm font-mono font-bold text-slate-700">{results ? formatDate(results.targetDateObj) : '-'}</span>
                                            </div>
                                            <div className="h-px bg-slate-200"></div>
                                            
                                            <div className="flex justify-between items-start pt-1">
                                                <span className="text-xs text-slate-500 mt-1">経過時間</span>
                                                <div className="flex flex-col items-end">
                                                    <span className="text-sm font-mono text-slate-600 mb-1">
                                                        {results ? formatResultTime(results.elapsedInSeconds) : '-'}
                                                    </span>
                                                    <label className="flex items-center gap-1.5 cursor-pointer group select-none">
                                                        <div className={`w-3.5 h-3.5 rounded border flex items-center justify-center transition-colors ${isDetailedTime ? 'bg-blue-600 border-blue-600' : 'bg-white border-slate-300 group-hover:border-slate-400'}`}>
                                                            {isDetailedTime && <CheckSquare className="w-2.5 h-2.5 text-white" />}
                                                        </div>
                                                        <input 
                                                            type="checkbox" 
                                                            checked={isDetailedTime} 
                                                            onChange={(e) => setIsDetailedTime(e.target.checked)} 
                                                            className="hidden"
                                                        />
                                                        <span className="text-[10px] text-slate-400 group-hover:text-slate-600">詳細表示 (日/時/分/秒)</span>
                                                    </label>
                                                </div>
                                            </div>

                                        </div>
                                    </section>
                                ) : (
                                    <section className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div className="bg-white p-5 rounded-xl shadow-sm border-l-4 border-amber-500 flex flex-col justify-center relative">
                                            <p className="text-xs text-slate-500 mb-1">必要な時間 (所要時間)</p>
                                            <p className="text-2xl font-bold text-amber-600 tracking-tight mb-2">
                                                {results ? formatResultTime(results.elapsedInSeconds) : '-'}
                                            </p>
                                            
                                            <div className="absolute top-4 right-4">
                                                <label className="flex items-center gap-1.5 cursor-pointer group bg-slate-50 px-2 py-1 rounded hover:bg-slate-100 transition-colors select-none">
                                                    <div className={`w-3.5 h-3.5 rounded border flex items-center justify-center transition-colors ${isDetailedTime ? 'bg-amber-600 border-amber-600' : 'bg-white border-slate-300 group-hover:border-slate-400'}`}>
                                                        {isDetailedTime && <CheckSquare className="w-2.5 h-2.5 text-white" />}
                                                    </div>
                                                    <input 
                                                        type="checkbox" 
                                                        checked={isDetailedTime} 
                                                        onChange={(e) => setIsDetailedTime(e.target.checked)} 
                                                        className="hidden"
                                                    />
                                                    <span className="text-[10px] text-slate-400 group-hover:text-slate-600">詳細表示</span>
                                                </label>
                                            </div>

                                            <p className="text-xs text-slate-400 mt-1">
                                                {results && results.elapsedInSeconds < 0 ? '過去に遡ります' : '未来へ経過'}
                                            </p>
                                        </div>
                                        <div className="bg-amber-50 p-5 rounded-xl border border-amber-100 flex flex-col justify-center">
                                            <p className="text-xs text-amber-800 mb-1">到達する日時</p>
                                            <p className="text-xl font-mono font-bold text-amber-900 tracking-tight">
                                                {results ? formatDate(results.targetDateObj) : '-'}
                                            </p>
                                            <p className="text-[10px] text-amber-700/60 mt-2">
                                                基準日時: {formatDate(new Date(baseDate))}
                                            </p>
                                        </div>
                                    </section>
                                )}

                                <section className="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="font-bold text-slate-700 flex items-center gap-2">
                                            <Activity className="w-4 h-4 text-slate-400" />
                                            減衰シミュレーショングラフ
                                        </h3>
                                    </div>
                                    <Graph />
                                    <div className="mt-4 bg-slate-50 p-3 rounded text-xs text-slate-500 space-y-1">
                                        {mainMode === 'amount' ? (
                                            <p>グラフ上の赤い点は、指定された時間経過後の残存量を示しています。</p>
                                        ) : (
                                            <p>グラフ上の赤い点は、目標量 {formatNumber(targetAmount)} MBq に到達する時点を示しています。</p>
                                        )}
                                        <p className="opacity-70">横軸: 時間, 縦軸: 量 (MBq)</p>
                                    </div>
                                </section>
                            </div>
                        </div>
                    </div>

                    {isPresetModalOpen && (
                        <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
                            <div className="bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden animate-in fade-in zoom-in-95 duration-200">
                                <div className="p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50">
                                    <h3 className="font-bold text-slate-700 flex items-center gap-2">
                                        <Settings className="w-4 h-4" />
                                        プリセットの管理
                                    </h3>
                                    <button 
                                        onClick={() => setIsPresetModalOpen(false)}
                                        className="text-slate-400 hover:text-slate-600 p-1"
                                    >
                                        <XIcon className="w-5 h-5" />
                                    </button>
                                </div>
                                
                                <div className="p-4 max-h-[60vh] overflow-y-auto">
                                    <div className="space-y-2 mb-4">
                                        {presets.map((preset) => (
                                            <div key={preset.id} className="flex items-center justify-between p-2 bg-slate-50 border border-slate-200 rounded">
                                                <div>
                                                    <div className="text-sm font-bold text-slate-700">{preset.label}</div>
                                                    <div className="text-xs text-slate-500">
                                                        {preset.value} {TIME_UNITS[preset.unit].label}
                                                    </div>
                                                </div>
                                                <button 
                                                    onClick={() => handleDeletePreset(preset.id)}
                                                    className="text-slate-400 hover:text-red-500 p-2"
                                                >
                                                    <Trash2 className="w-4 h-4" />
                                                </button>
                                            </div>
                                        ))}
                                        {presets.length === 0 && (
                                            <div className="text-center py-4 text-slate-400 text-sm">プリセットがありません</div>
                                        )}
                                    </div>

                                    {presets.length < 10 ? (
                                        <div className="bg-blue-50 p-3 rounded border border-blue-100">
                                            <div className="text-xs font-bold text-blue-800 mb-2 flex items-center gap-1">
                                                <Plus className="w-3 h-3" />
                                                新規追加 ({presets.length}/10)
                                            </div>
                                            <div className="space-y-2">
                                                <input
                                                    type="text"
                                                    placeholder="名称 (例: コバルト60)"
                                                    value={newPreset.label}
                                                    onChange={(e) => setNewPreset({...newPreset, label: e.target.value})}
                                                    className="w-full px-2 py-1.5 border border-blue-200 rounded text-sm focus:outline-none focus:border-blue-500"
                                                />
                                                <div className="flex gap-2">
                                                    <input
                                                        type="number"
                                                        placeholder="半減期の値"
                                                        value={newPreset.value}
                                                        onChange={(e) => setNewPreset({...newPreset, value: e.target.value})}
                                                        className="flex-1 px-2 py-1.5 border border-blue-200 rounded text-sm focus:outline-none focus:border-blue-500"
                                                    />
                                                    <select
                                                        value={newPreset.unit}
                                                        onChange={(e) => setNewPreset({...newPreset, unit: e.target.value})}
                                                        className="w-20 px-1 py-1.5 border border-blue-200 rounded text-sm bg-white"
                                                    >
                                                        {Object.entries(TIME_UNITS).map(([k, u]) => <option key={k} value={k}>{u.label}</option>)}
                                                    </select>
                                                </div>
                                                <button
                                                    onClick={handleAddPreset}
                                                    disabled={!newPreset.label || !newPreset.value}
                                                    className="w-full py-1.5 bg-blue-600 text-white rounded text-sm font-bold hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-1"
                                                >
                                                    <Save className="w-3 h-3" />
                                                    追加する
                                                </button>
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="text-center text-xs text-amber-600 bg-amber-50 p-2 rounded">
                                            最大登録数（10件）に達しています
                                        </div>
                                    )}
                                </div>

                                <div className="p-3 border-t border-slate-100 bg-slate-50 text-right">
                                    <button 
                                        onClick={() => setIsPresetModalOpen(false)}
                                        className="px-4 py-2 bg-white border border-slate-300 rounded text-sm text-slate-600 hover:bg-slate-100"
                                    >
                                        閉じる
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>